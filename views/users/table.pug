extends ../layout

block content
  .container
    if deleted
      .alert.alert-warning.alert-dismissible.fade.show.d-flex.justify-content-between.align-items-center(role='alert')
        span Gebruiker is gedeactiveerd.
        if deletedId
          form.d-inline(method='post', action=`/users/${deletedId}/restore`)
            button.btn.btn-sm.btn-outline-dark(type='submit') Undo
        button.btn-close(type='button', data-bs-dismiss='alert', aria-label='Close')

    if restored
      .alert.alert-success.alert-dismissible.fade.show(role='alert')
        | Gebruiker is hersteld.
        button.btn-close(type='button', data-bs-dismiss='alert', aria-label='Close')

    h1 Users
    table.table.table-striped
      thead
        tr
          th ID
          th First name
          th Last name
          th Email
          th Actions
      tbody
        each u in users
          tr
            td= u.customer_id
            td= u.first_name
            td= u.last_name
            td= u.email
            td
              a.btn.btn-primary.btn-sm(href=`/users/${u.customer_id}/details`) Details
              form.d-inline.ms-3(method='post', action=`/users/${u.customer_id}/delete`, onsubmit='return confirm("Weet je zeker dat je deze gebruiker wilt verwijderen?")')
                button.btn.btn-danger.btn-sm(type='submit') Delete

  // Auto-dismiss alerts + verwijder querystring na render
  script.
    (function () {
      var alerts = document.querySelectorAll('.alert');
      if (alerts.length) {
        setTimeout(function () {
          alerts.forEach(function (el) {
            // Trig het bootstrap-close event en fade out
            var evt = new Event('close.bs.alert');
            el.dispatchEvent(evt);
            el.classList.remove('show');
            setTimeout(function () {
              if (el && el.parentNode) el.parentNode.removeChild(el);
            }, 250);
          });
        }, 4000); // 4 seconden
      }
      // Haal ?deleted=1&id=.. of ?restored=1 uit de URL
      if (window.location.search) {
        var clean = window.location.origin + window.location.pathname;
        window.history.replaceState({}, document.title, clean);
      }
    })();
